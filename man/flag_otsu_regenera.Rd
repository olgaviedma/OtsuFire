% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/5.flag_otsu_regenera.R
\name{flag_otsu_regenera}
\alias{flag_otsu_regenera}
\title{Flag Burned Polygons Based on Regeneration Overlap}
\usage{
flag_otsu_regenera(
  burned_files,
  regenera_files,
  min_regen_ratio = c(0.01, 0.05, 0.2),
  remove_no_regenera = FALSE,
  remove_condition = c("any_year", "year1_only", "year2_only", "year1_and_year2",
    "all_years"),
  all_years_vector = NULL,
  output_dir = NULL
)
}
\arguments{
\item{burned_files}{Character vector with paths to burned area shapefiles (.shp).}

\item{regenera_files}{Character vector with paths to regeneration shapefiles (.shp).
Filenames must contain `"P1"`, `"P2"`, etc., to indicate regeneration year after fire.}

\item{min_regen_ratio}{Numeric vector of thresholds (between 0 and 1) to define sufficient regeneration.
Default: `c(0.01, 0.05, 0.20)`.}

\item{remove_no_regenera}{Logical. If `TRUE`, polygons not flagged as `"regenera"` are excluded from the filtered output.}

\item{remove_condition}{Condition applied when `remove_no_regenera = TRUE`. One of:
\describe{
  \item{`"any_year"`}{Keep polygon if regeneration in **at least one year** meets the threshold.}
  \item{`"year1_only"`}{Keep only if regeneration in year 1 (`P1`) meets the threshold.}
  \item{`"year2_only"`}{Keep only if regeneration in year 2 (`P2`) meets the threshold.}
  \item{`"year1_and_year2"`}{Keep only if `regen_ratio_P1 > 0` **and** `regen_ratio_P2 ≥ threshold`.}
  \item{`"all_years"`}{Keep only if **all** years in `all_years_vector` meet the threshold.}
}}

\item{all_years_vector}{Character vector indicating the labels of regeneration years to consider for `"all_years"` filtering. Example: `c("P1", "P2", "P3")`.
Only used when `remove_condition = "all_years"`.}

\item{output_dir}{Optional output directory. If `NULL`, results are saved in the same location as the burned files.}
}
\value{
Three shapefiles per burned area file and threshold:
\describe{
  \item{Main shapefile}{With regeneration ratios and flags for each polygon.}
  \item{Filtered shapefile}{(optional, if `remove_no_regenera = TRUE`) Only polygons flagged as `"regenera"`. Filename includes `"_filter"`.}
  \item{Final shapefile with replacements}{Polygons where burned groups were replaced by P1 polygons if larger. Filename includes `"_new_polys"`.}
}
}
\description{
This function assigns regeneration flags to burned area polygons based on their spatial
overlap with post-fire regeneration polygons (e.g., from years 1, 2, or more after fire).
A polygon is flagged as `"regenera"` if the total intersected area with regeneration polygons
from a specific year exceeds a minimum threshold proportion (`min_regen_ratio`) of the
burned polygon's area.
}
\details{
Filenames of regeneration layers must contain `"P1"`, `"P2"`, etc., to indicate the year
after fire. These are automatically extracted and used to name ratio and flag columns.

## Flags and Output Columns:
For each regeneration year detected (e.g., P1, P2, P3), the function adds:
- `regen_ratio_P1`, `regen_ratio_P2`, ...: ratio of regeneration area to burned area (ha/ha)
- `regenera_flag_P1`, `regenera_flag_P2`, ...: `"regenera"` or `"no_regenera"` depending on threshold

If `remove_condition = "year1_and_year2"` is selected, an additional field `regenera_flag_joint` is created,
set to `"regenera"` only if:
- `regen_ratio_P1` > 0 **and**
- `regen_ratio_P2` ≥ threshold.

If `remove_condition = "all_years"` is selected, all years in `all_years_vector` must meet the threshold.
}
\examples{
\dontrun{
# Example using multiple thresholds and custom all_years condition
burned_files <- list.files("burned_dir", pattern = "burned_.*\\\\.shp$", full.names = TRUE)
regenera_files <- list.files("burned_dir", pattern = "regenera_.*\\\\.shp$", full.names = TRUE)

flag_otsu_regenera(
  burned_files = burned_files,
  regenera_files = regenera_files,
  min_regen_ratio = c(0.10),
  remove_no_regenera = TRUE,
  remove_condition = "all_years",
  all_years_vector = c("P1", "P2", "P3"),
  output_dir = "results"
)
}

}
